---
  - hosts: tag_Name_Application
    user: ubuntu
    gather_facts: no
    become: yes
    become_method: sudo
    tasks:
      - name: make directory
        shell: mkdir /opt/splunkforwarder

      - name: wget splunk installation file
        get_url:
          url: https://s3.amazonaws.com/bhakty-files/splunkforwarder.deb
          dest: /opt/splunkforwarder/

      - name: install splunk binary
        tags:
          - install
        apt: deb=/opt/splunkforwarder/splunkforwarder.deb

      - set_fact:
          temp: "{{ hostvars[inventory_hostname]['groups']['tag_Name_Indexer_1'] | to_json }}"
      
      - debug: var=temp

      - name: enable receiving
        shell: /opt/splunkforwarder/bin/splunk add forward-server {{ temp }}:9997 --accept-license --no-prompt

      - name: file to monitor
        shell: /opt/splunkforwarder/bin/splunk add monitor /var/www/html/

      - name: restart
        shell:  /opt/splunkforwarder/bin/splunk restart
